<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<title>拉比克</title>
<link rel='stylesheet prefetch' href='http://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css'>
<link rel="stylesheet" href="css/style.css">
<script src="js/md5.js" type="text/javascript"></script>
</head>

<body onload="">
	<div class="wrapper">
		<form class="form-signin" id="loginForm" action="" method="post">
			<h2 class="form-signin-heading">rubick</h2>
			<input type="text" class="form-control" id="userName" name="loginName" placeholder="用户名" required="" autofocus="" /> 
			<input type="password" class="form-control" id="password" name="password" placeholder="密码" required="" /> 
			<input name="verifycode" class="form-control" style="width: 60%;float: left;" placeholder="验证码" id="verifycode" maxlength="4" value="">
			<img src="/rubick/verifycode" style="width: 40%; float: left; padding: 10px;" onclick="this.src='/rubick/verifycode?d='+new Date();"/>
			<!-- <button class="btn btn-lg btn-primary btn-block" type="submit">Login</button> -->
			<button class="btn btn-lg btn-primary btn-block" style="width: 50%; margin:0 auto;" type="button" onClick="getContextPath()">登录</button>
		</form>
	</div>
</body>
<script type="text/javascript">
function getContextPath() {
	var pathName = document.location.pathname;
	var index = pathName.substr(1).indexOf("/");
	var result = pathName.substr(0, index + 1);
	var loginForm = document.getElementById("loginForm");
	var password = document.getElementById("password");
	
	var userName = document.getElementById("userName").value;
	var password = document.getElementById("password").value;
	var verifycode = document.getElementById("verifycode").value;
	var xhr = new XMLHttpRequest()
	xhr.onreadystatechange = function(){
		if(this.readyState == 4){
		  if (this.status==200){
		  	window.location.href = "/swagger-ui.html";
		  }else{
		    alert(JSON.parse(this.responseText).message);
		  }
		  
		}
	}
	xhr.open('post', result + "/login" );
	xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	xhr.send('loginName=' + userName +　'&password=' + hex_md5(password) + '&verifycode=' + verifycode);
}
</script>
</html>
